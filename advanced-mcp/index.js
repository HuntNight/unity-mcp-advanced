#!/usr/bin/env node

/**
 * üö® –í–ù–ò–ú–ê–ù–ò–ï –î–õ–Ø –ò–ò: –≠–¢–û–¢ –°–ï–†–í–ï–† –ù–ï –ó–ê–ü–£–°–ö–ê–¢–¨ –ß–ï–†–ï–ó –¢–ï–†–ú–ò–ù–ê–õ!
 * 
 * ‚ùå –ù–ï –î–ï–õ–ê–¢–¨: node index.js
 * ‚ùå –ù–ï –î–ï–õ–ê–¢–¨: run_terminal_cmd —Å –∑–∞–ø—É—Å–∫–æ–º —Å–µ—Ä–≤–µ—Ä–∞
 * 
 * ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û: –ü–æ–ø—Ä–æ—Å–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–µ—Ä –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö Cursor'–∞
 * 
 * MCP —Å–µ—Ä–≤–µ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç –¢–û–õ–¨–ö–û —á–µ—Ä–µ–∑ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é —Å Cursor'–æ–º!
 * –ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ —Ç–µ—Ä–º–∏–Ω–∞–ª –ù–ï –†–ê–ë–û–¢–ê–ï–¢ –∏ –±–µ—Å–∏—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è!
 */

/**
 * üöÄ –î–ò–ù–ê–ú–ò–ß–ï–°–ö–ê–Ø –ê–†–•–ò–¢–ï–ö–¢–£–†–ê MCP - –†–ï–í–û–õ–Æ–¶–ò–Ø!
 * 
 * üî• –ê–†–•–ò–¢–ï–ö–¢–£–†–ù–ê–Ø –ò–î–ï–Ø: –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥—É–ª–µ–π!
 * 
 * üèóÔ∏è –ù–û–í–ê–Ø –ê–†–•–ò–¢–ï–ö–¢–£–†–ê:
 * ‚îú‚îÄ‚îÄ utils/           # üîß –û–±—â–∏–µ —É—Ç–∏–ª–∏—Ç—ã + –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è –∑–∞–≥—Ä—É–∑–∫–∞
 * ‚îú‚îÄ‚îÄ tools/           # üéØ –ú–æ–¥—É–ª–∏ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –î–ò–ù–ê–ú–ò–ß–ï–°–ö–ò!
 * ‚îÇ   ‚îú‚îÄ‚îÄ unity.js         # üéÆ Unity Bridge API (–ü–ï–†–ï–ü–ò–°–ê–ù!)
 * ‚îÇ   ‚îú‚îÄ‚îÄ terminal.js      # üíª –í—Å–µ terminal –∫–æ–º–∞–Ω–¥—ã
 * ‚îÇ   ‚îú‚îÄ‚îÄ filesystem.js    # üìÅ –í—Å–µ —Ñ–∞–π–ª–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
 * ‚îÇ   ‚îî‚îÄ‚îÄ git.js           # üîß Git –æ–ø–µ—Ä–∞—Ü–∏–∏
 * ‚îî‚îÄ‚îÄ index.js         # üöÄ –ü—Ä–æ—Å—Ç–æ —Å–æ–∑–¥–∞—ë—Ç —Å–µ—Ä–≤–µ—Ä –∏ –≥–æ–≤–æ—Ä–∏—Ç "–∑–∞–≥—Ä—É–∑–∏ –º–æ–¥—É–ª–∏"
 * 
 * üí° –†–ï–í–û–õ–Æ–¶–ò–û–ù–ù–´–ï –í–û–ó–ú–û–ñ–ù–û–°–¢–ò:
 * - üîÑ HOT RELOAD: –∏–∑–º–µ–Ω–∏–ª —Ñ–∞–π–ª ‚Üí –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏–ª ‚Üí —Ä–∞–±–æ—Ç–∞–µ—Ç!
 * - üÜï ADD: –¥–æ–±–∞–≤–∏–ª –Ω–æ–≤—ã–π —Ñ–∞–π–ª –≤ tools/ ‚Üí –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥—Ö–≤–∞—Ç–∏–ª—Å—è!
 * - üîÑ REPLACE: —Ñ–∞–π–ª —Å —Ç–µ–º –∂–µ –∏–º–µ–Ω–µ–º ‚Üí –∑–∞–º–µ–Ω—è–µ—Ç —Å—Ç–∞—Ä—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã!
 * - üöÄ LIVE CODING: –ø–∏—à–µ—à—å –∫–æ–¥ –≤ —á–∞—Ç–µ ‚Üí —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è ‚Üí –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è!
 * 
 * üéØ –ù–ò–ö–ê–ö–ò–• –°–¢–ê–¢–ò–ß–ï–°–ö–ò–• –ò–ú–ü–û–†–¢–û–í!
 * –í—Å—ë –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –∏–∑ –ø–∞–ø–∫–∏ tools/
 */

import { createMcpServer } from './utils/mcpServer.js';

// üö® –ì–õ–û–ë–ê–õ–¨–ù–ê–Ø –ó–ê–©–ò–¢–ê –û–¢ –ü–ê–î–ï–ù–ò–Ø –°–ï–†–í–ï–†–ê! üö®
// –≠—Ç–∏ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –ª–æ–≤—è—Ç –í–°–ï unhandled errors –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç —É—Ä–æ–Ω–∏—Ç—å –ø—Ä–æ—Ü–µ—Å—Å!

process.on('uncaughtException', (error) => {
  console.error('üö® UNCAUGHT EXCEPTION - –°–ï–†–í–ï–† –ù–ï –£–ü–ê–î–Å–¢!');
  console.error('‚ùå Error:', error.message);
  console.error('üìö Stack:', error.stack);
  console.error('üõ°Ô∏è –°–µ—Ä–≤–µ—Ä –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –±–ª–∞–≥–æ–¥–∞—Ä—è –≥–ª–æ–±–∞–ª—å–Ω–æ–π –∑–∞—â–∏—Ç–µ!');
  // –ù–ï –í–´–ó–´–í–ê–ï–ú process.exit() - –ø—É—Å—Ç—å —Å–µ—Ä–≤–µ—Ä –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å!
});

process.on('unhandledRejection', (reason, promise) => {
  console.error('üö® UNHANDLED PROMISE REJECTION - –°–ï–†–í–ï–† –ù–ï –£–ü–ê–î–Å–¢!');
  console.error('‚ùå Reason:', reason);
  console.error('üìç Promise:', promise);
  console.error('üõ°Ô∏è –°–µ—Ä–≤–µ—Ä –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –±–ª–∞–≥–æ–¥–∞—Ä—è –≥–ª–æ–±–∞–ª—å–Ω–æ–π –∑–∞—â–∏—Ç–µ!');
  // –ù–ï –í–´–ó–´–í–ê–ï–ú process.exit() - –ø—É—Å—Ç—å —Å–µ—Ä–≤–µ—Ä –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å!
});

// üî• –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–ê–Ø –ó–ê–©–ò–¢–ê –û–¢ CHILD_PROCESS –û–®–ò–ë–û–ö
process.on('error', (error) => {
  console.error('üö® PROCESS ERROR - –°–ï–†–í–ï–† –ù–ï –£–ü–ê–î–Å–¢!');
  console.error('‚ùå Error:', error.message);
  console.error('üõ°Ô∏è –°–µ—Ä–≤–µ—Ä –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –±–ª–∞–≥–æ–¥–∞—Ä—è –≥–ª–æ–±–∞–ª—å–Ω–æ–π –∑–∞—â–∏—Ç–µ!');
});

// üöÄ –°–û–ó–î–ê–Å–ú –°–ï–†–í–ï–† –° –î–ò–ù–ê–ú–ò–ß–ï–°–ö–û–ô –ó–ê–ì–†–£–ó–ö–û–ô
const server = createMcpServer({
  name: "claude-enhanced-mcp",
  version: "2.0.0-DYNAMIC-PROTECTED", // üõ°Ô∏è –û–±–Ω–æ–≤–∏–ª –≤–µ—Ä—Å–∏—é!
  modulesPath: './tools'  // üî• –ü–∞–ø–∫–∞ –¥–ª—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–≥–æ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è!
});

// üßπ Graceful shutdown (–ø–æ–∫–∞ –æ—Å—Ç–∞–≤–ª—è–µ–º –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏)
process.on('SIGTERM', async () => {
  console.log('üõë Shutting down gracefully...');
  process.exit(0);
});

process.on('SIGINT', async () => {
  console.log('üõë Shutting down gracefully...');
  process.exit(0);
});

// üöÄ –ó–ê–ü–£–°–ö –î–ò–ù–ê–ú–ò–ß–ï–°–ö–û–ì–û MCP –°–ï–†–í–ï–†–ê!
server.start();

/**
 * üéâ –î–ò–ù–ê–ú–ò–ß–ï–°–ö–ê–Ø –†–ï–í–û–õ–Æ–¶–ò–Ø –ó–ê–í–ï–†–®–ï–ù–ê!
 * 
 * üî• –ü–†–ï–ò–ú–£–©–ï–°–¢–í–ê –ù–û–í–û–ô –ê–†–•–ò–¢–ï–ö–¢–£–†–´:
 * ‚úÖ –ú–æ–¥—É–ª–∏ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –∏–∑ –ø–∞–ø–∫–∏ tools/
 * ‚úÖ HOT RELOAD –±–µ–∑ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ MCP —Å–µ—Ä–≤–µ—Ä–∞
 * ‚úÖ –î–æ–±–∞–≤–∏–ª —Ñ–∞–π–ª ‚Üí —Å—Ä–∞–∑—É —Ä–∞–±–æ—Ç–∞–µ—Ç
 * ‚úÖ –ò–∑–º–µ–Ω–∏–ª —Ñ–∞–π–ª ‚Üí –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏–ª ‚Üí —Ä–∞–±–æ—Ç–∞–µ—Ç
 * ‚úÖ LIVE CODING –ø—Ä—è–º–æ –≤ —á–∞—Ç–µ!
 * ‚úÖ –ù–∏–∫–∞–∫–∏—Ö —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏—Ö –∏–º–ø–æ—Ä—Ç–æ–≤
 * ‚úÖ –ü–æ–ª–Ω–∞—è –≥–∏–±–∫–æ—Å—Ç—å –∏ —Ä–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç—å
 * ‚úÖ üõ°Ô∏è –ì–õ–û–ë–ê–õ–¨–ù–ê–Ø –ó–ê–©–ò–¢–ê –û–¢ –ü–ê–î–ï–ù–ò–Ø –°–ï–†–í–ï–†–ê!
 * 
 * üöÄ –ö–ê–ö –î–û–ë–ê–í–ò–¢–¨ –ù–û–í–´–ô –ú–û–î–£–õ–¨:
 * 1. –°–æ–∑–¥–∞—Ç—å tools/–º–æ–π-–º–æ–¥—É–ª—å.js
 * 2. –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –æ–±—ä–µ–∫—Ç —Å tools: { toolName: { description, inputSchema, handler } }
 * 3. –í—Å—ë! –ú–æ–¥—É–ª—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥—Ö–≤–∞—Ç–∏—Ç—Å—è –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
 * 4. –î–ª—è hot reload: –∏—Å–ø–æ–ª—å–∑—É–π live_code_deploy –∏–ª–∏ reloadAllModules()
 * 
 * üõ°Ô∏è –ì–õ–û–ë–ê–õ–¨–ù–ê–Ø –ó–ê–©–ò–¢–ê:
 * - uncaughtException: –ª–æ–≤–∏—Ç –≤—Å–µ —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –æ—à–∏–±–∫–∏
 * - unhandledRejection: –ª–æ–≤–∏—Ç –≤—Å–µ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ Promise –æ—à–∏–±–∫–∏  
 * - process error: –ª–æ–≤–∏—Ç –æ—à–∏–±–∫–∏ —Å–∞–º–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞
 * - child_process spawn ENOENT: —Ç–µ–ø–µ—Ä—å –ù–ï –†–û–ù–Ø–ï–¢ —Å–µ—Ä–≤–µ—Ä!
 * 
 * üèÜ –≠–¢–û –û–¢–õ–ò–ß–ù–ê–Ø –ê–†–•–ò–¢–ï–ö–¢–£–†–ù–ê–Ø –ò–î–ï–Ø!
 * –î–ò–ù–ê–ú–ò–ß–ï–°–ö–ê–Ø –ó–ê–ì–†–£–ó–ö–ê + HOT RELOAD + –ì–õ–û–ë–ê–õ–¨–ù–ê–Ø –ó–ê–©–ò–¢–ê = –ò–î–ï–ê–õ–¨–ù–ê–Ø –ê–†–•–ò–¢–ï–ö–¢–£–†–ê!
 */ 